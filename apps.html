<!DOCTYPE html>
<html class="light" lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>授業用アプリ一覧</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#4A90E2",
            "background-light": "#F8F9FA",
            "background-dark": "#101922",
          },
          fontFamily: {
            "sans": ["Noto Sans JP", "Open Sans", "sans-serif"]
          },
          borderRadius: {
            "DEFAULT": "0.5rem",
            "lg": "0.75rem",
            "xl": "1rem",
            "full": "9999px"
          },
        },
      },
    }
  </script>

  <style>
    body {
      font-family: 'Noto Sans JP', 'Open Sans', sans-serif;
    }
  </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-sans text-gray-800 dark:text-gray-200">
<div class="relative flex min-h-screen w-full flex-col">

  <!-- 共通ヘッダー -->
  <header class="sticky top-0 z-50 flex items-center justify-between border-b border-solid border-gray-200 dark:border-gray-700 bg-white/80 dark:bg-background-dark/80 backdrop-blur-sm px-4 sm:px-6 lg:px-8 h-16 shadow-sm">
    <div class="flex items-center gap-3">
      <div class="flex-shrink-0 text-primary">
        <span class="material-symbols-outlined text-primary text-3xl leading-none">science</span>
      </div>
      <h1 class="text-gray-900 dark:text-white text-sm sm:text-base font-bold leading-tight tracking-tight">
        Physics App Lab
      </h1>
    </div>

    <nav class="hidden md:flex items-center gap-6 text-sm font-medium">
      <a class="nav-link-home text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary" href="./index.html">Home</a>
      <a class="nav-link-apps text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary" href="./apps.html">Apps</a>
      <a class="nav-link-support text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary" href="./support.html">Support</a>
    </nav>

    <button class="md:hidden flex items-center justify-center p-2 rounded-lg bg-gray-100 dark:bg-gray-800">
      <span class="material-symbols-outlined text-gray-800 dark:text-gray-200">menu</span>
    </button>
  </header>

  <!-- Main -->
  <main class="flex-grow px-4 sm:px-6 lg:px-8 py-10">
    <div class="max-w-7xl mx-auto">

      <!-- Title / Intro / Filters -->
      <div class="flex flex-col gap-8 mb-10">
        <div>
          <h2 class="text-gray-900 dark:text-white text-3xl sm:text-4xl font-bold tracking-tight">授業用アプリ一覧</h2>
          <p class="text-gray-600 dark:text-gray-400 text-base sm:text-lg mt-2">
            物理の授業で使えるインタラクティブなWebアプリ集です。
          </p>
        </div>

        <div class="flex flex-col gap-6">

          <!-- Subject Filter -->
          <div class="flex flex-col sm:flex-row sm:items-center gap-4">
            <h3 class="text-gray-800 dark:text-gray-200 text-base font-bold whitespace-nowrap">分野フィルター:</h3>
            <div class="flex gap-2 flex-wrap" id="subject-filters">
              <!-- data-subject の値は apps.json の "subject" と一致させる -->
              <button data-subject="力学" class="flex h-9 items-center justify-center rounded-full bg-primary/20 px-4 text-primary text-sm font-medium transition-colors">
                力学
              </button>
              <button data-subject="熱・気体" class="flex h-9 items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 px-4 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm font-medium transition-colors">
                熱・気体
              </button>
              <button data-subject="波動" class="flex h-9 items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 px-4 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm font-medium transition-colors">
                波動
              </button>
              <button data-subject="電磁気" class="flex h-9 items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 px-4 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm font-medium transition-colors">
                電磁気
              </button>
              <button data-subject="原子" class="flex h-9 items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 px-4 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm font-medium transition-colors">
                原子
              </button>
            </div>
          </div>

          <!-- Type Filter -->
          <div class="flex flex-col sm:flex-row sm:items-center gap-4">
            <h3 class="text-gray-800 dark:text-gray-200 text-base font-bold whitespace-nowrap">種類フィルター:</h3>
            <div class="flex gap-2 flex-wrap" id="type-filters">
              <!-- data-type の値は apps.json の "type" と一致させる -->
              <button data-type="実験" class="flex h-9 items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 px-4 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm font-medium transition-colors">
                実験アプリ
              </button>
              <button data-type="シミュレーション" class="flex h-9 items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 px-4 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm font-medium transition-colors">
                シミュレーションアプリ
              </button>
            </div>
          </div>

        </div>
      </div>

      <!-- Cards -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8" id="app-card-grid">
        <!-- JSでdata/apps.jsonから生成 -->
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="mt-auto bg-gray-100 dark:bg-gray-900">
    <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center">
      <p class="text-gray-500 dark:text-gray-400 text-sm">© 2025 Kohei Ushiroda</p>
    </div>
  </footer>
</div>

<script>
  // --- 状態管理 -------------------------------------------------
  let allApps = [];
  let activeSubject = null; // ex. "力学"
  let activeType = null;    // ex. "実験" / "シミュレーション"

  // 選択状態の見た目用クラス
  const activeFilterClass   = "flex h-9 items-center justify-center rounded-full bg-primary/20 px-4 text-primary text-sm font-medium transition-colors";
  const inactiveFilterClass = "flex h-9 items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 px-4 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm font-medium transition-colors";

  // --- URLパラメータから初期フィルタを反映 ---------------------
  function initFiltersFromURL() {
    const params = new URLSearchParams(window.location.search);
    const subjectParam = params.get('subject');
    const typeParam    = params.get('type');

    if (subjectParam) {
      activeSubject = subjectParam;
    }
    if (typeParam) {
      activeType = typeParam;
    }
  }

  // --- カード描画 ----------------------------------------------
  function renderCards() {
    const grid = document.getElementById('app-card-grid');
    grid.innerHTML = '';

    const filtered = allApps.filter(app => {
      const okSubject = activeSubject ? app.subject === activeSubject : true;
      const okType    = activeType    ? app.type === activeType       : true;
      return okSubject && okType;
    });

    filtered.forEach(app => {
      const card = document.createElement('div');
      card.className = "flex flex-col bg-white dark:bg-gray-800 rounded-xl shadow-sm hover:shadow-lg transition-shadow duration-300";

      card.innerHTML = `
        <div class="p-6 flex flex-col gap-4">

          <!-- タイトル -->
          <h3 class="text-gray-900 dark:text-white text-lg font-bold">
            ${app.title}
          </h3>

          <!-- スクリーンショット -->
          <div class="w-full aspect-video bg-gray-200 dark:bg-gray-700 rounded-lg overflow-hidden">
            <img
              src="${app.screenshot}"
              alt="${app.title} の画面"
              class="w-full h-full object-cover"
            />
          </div>

          <!-- 説明 -->
          <p class="text-gray-600 dark:text-gray-400 text-sm leading-relaxed">
            ${app.description}
          </p>

          <!-- タグ -->
          <div class="flex gap-2 flex-wrap">
            <span class="inline-block bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-1 rounded-full">${app.subject}</span>
            <span class="inline-block bg-green-100 text-green-800 text-xs font-semibold px-2.5 py-1 rounded-full">${app.type}</span>
          </div>
        </div>

        <!-- ボタン -->
        <div class="mt-auto p-4 bg-gray-50 dark:bg-gray-800/50 flex gap-3">
          <a
            href="${app.launchUrl}"
            target="_blank"
            rel="noopener noreferrer"
            class="flex-1 flex items-center justify-center rounded-lg h-10 px-4 bg-primary text-white text-sm font-bold hover:bg-primary/90 transition-colors"
          >
            起動
          </a>
          <a
            href="${app.detailUrl}"
            class="flex-1 flex items-center justify-center rounded-lg h-10 px-4 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm font-bold hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
          >
            詳細
          </a>
        </div>
      `;

      grid.appendChild(card);
    });
  }

  // --- フィルタボタンの見た目を更新 ----------------------------
  function highlightFilters() {
    document.querySelectorAll('[data-subject]').forEach(btn => {
      const val = btn.getAttribute('data-subject');
      btn.className = (activeSubject === val) ? activeFilterClass : inactiveFilterClass;
    });

    document.querySelectorAll('[data-type]').forEach(btn => {
      const val = btn.getAttribute('data-type');
      btn.className = (activeType === val) ? activeFilterClass : inactiveFilterClass;
    });
  }

  // --- ボタンクリック時の処理 ----------------------------------
  function toggleFilter(e) {
    const btn = e.currentTarget;
    const subject = btn.getAttribute('data-subject');
    const type    = btn.getAttribute('data-type');

    if (subject !== null) {
      activeSubject = (activeSubject === subject) ? null : subject;
    }
    if (type !== null) {
      activeType = (activeType === type) ? null : type;
    }

    renderCards();
    highlightFilters();
  }

  // --- 初期化フロー --------------------------------------------
  window.addEventListener('DOMContentLoaded', () => {
    // 1. URLの?subject=... / ?type=... を読んで反映
    initFiltersFromURL();

    // 2. フィルタボタンにクリックイベント付与
    document.querySelectorAll('[data-subject], [data-type]').forEach(btn => {
      btn.addEventListener('click', toggleFilter);
    });

    // 3. apps.jsonを読み込み、カード生成
    fetch('./data/apps.json')
      .then(res => res.json())
      .then(data => {
        allApps = data;
        renderCards();
        highlightFilters();
      })
      .catch(err => console.error('apps load error', err));
  });
</script>

</body>
</html>
