<!DOCTYPE html>
<html class="light" lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>アプリ一覧</title>

  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#4A90E2",
            "background-light": "#F8F9FA",
            "background-dark": "#101922",
          },
          fontFamily: {
            "sans": ["Noto Sans JP", "Open Sans", "sans-serif"]
          },
          borderRadius: {
            "DEFAULT": "0.5rem",
            "lg": "0.75rem",
            "xl": "1rem",
            "full": "9999px"
          },
        },
      },
    }
  </script>

  <style>
    body {
      font-family: 'Noto Sans JP', 'Open Sans', sans-serif;
    }
  </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-sans text-gray-800 dark:text-gray-200">
<div class="relative flex min-h-screen w-full flex-col">
  <!-- ヘッダー -->
  <header class="sticky top-0 z-50 flex items-center justify-between whitespace-nowrap border-b border-solid border-gray-200 dark:border-gray-700 bg-background-light/95 dark:bg-background-dark/95 backdrop-blur-sm px-4 sm:px-6 lg:px-8 h-16">
    <div class="flex items-center gap-4">
      <span class="material-symbols-outlined text-primary text-3xl">science</span>
      <h2 class="text-gray-900 dark:text-white text-xl font-bold tracking-tight">Physics App Lab</h2>
    </div>

    <nav class="hidden md:flex items-center gap-6">
      <a class="text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary text-sm font-medium" href="./index.html">Home</a>
      <a class="text-primary text-sm font-bold" href="./apps.html">Apps</a>
      <a class="text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary text-sm font-medium" href="./support.html">Support</a>
    </nav>
    <button class="md:hidden flex items-center justify-center p-2 rounded-lg bg-gray-100 dark:bg-gray-800">
      <span class="material-symbols-outlined text-gray-800 dark:text-gray-200">menu</span>
    </button>
  </header>

  <!-- メイン -->
  <main class="flex-grow px-4 sm:px-6 lg:px-8 py-10">
    <div class="max-w-7xl mx-auto">
      <!-- タイトルと説明 -->
      <div class="flex flex-col gap-8 mb-10">
        <div>
          <h1 class="text-gray-900 dark:text-white text-3xl sm:text-4xl font-bold tracking-tight">アプリ一覧</h1>
          <p class="text-gray-600 dark:text-gray-400 text-base sm:text-lg mt-2">
            物理の授業で使えるインタラクティブなWebアプリ集です。
          </p>
        </div>

        <!-- フィルター -->
        <div class="flex flex-col gap-6">

          <!-- 分野フィルター -->
          <div class="flex flex-col sm:flex-row sm:items-center gap-4">
            <h3 class="text-gray-800 dark:text-gray-200 text-base font-bold whitespace-nowrap">分野フィルター:</h3>
            <div class="flex gap-2 flex-wrap" id="subject-filters">
              <button data-subject="力学" class="flex h-9 items-center justify-center rounded-full bg-primary/20 px-4 text-primary text-sm font-medium transition-colors">力学</button>
              <button data-subject="熱" class="flex h-9 items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 px-4 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm font-medium transition-colors">熱</button>
              <button data-subject="波動" class="flex h-9 items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 px-4 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm font-medium transition-colors">波動</button>
              <button data-subject="電磁気" class="flex h-9 items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 px-4 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm font-medium transition-colors">電磁気</button>
              <button data-subject="熱・気体" class="flex h-9 items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 px-4 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm font-medium transition-colors">熱・気体</button>
              <button data-subject="原子" class="flex h-9 items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 px-4 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm font-medium transition-colors">原子</button>
            </div>
          </div>

          <!-- 種類フィルター -->
          <div class="flex flex-col sm:flex-row sm:items-center gap-4">
            <h3 class="text-gray-800 dark:text-gray-200 text-base font-bold whitespace-nowrap">種類フィルター:</h3>
            <div class="flex gap-2 flex-wrap" id="type-filters">
              <button data-type="実験" class="flex h-9 items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 px-4 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm font-medium transition-colors">実験アプリ</button>
              <button data-type="シミュレーション" class="flex h-9 items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 px-4 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm font-medium transition-colors">シミュレーションアプリ</button>
            </div>
          </div>

        </div>
      </div>

      <!-- アプリカードグリッド -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8" id="app-card-grid">
        <!-- JSでapps.jsonから生成 -->
      </div>
    </div>
  </main>

  <!-- フッター -->
  <footer class="mt-auto bg-gray-100 dark:bg-gray-900">
    <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center">
      <p class="text-gray-500 dark:text-gray-400 text-sm">© 2025 Kohei Ushiroda</p>
    </div>
  </footer>
</div>

<script>
  let allApps = [];
  let activeSubject = null; // "力学"など
  let activeType = null;    // "実験" or "シミュレーション"

  // JSONを読み込む
  fetch('./data/apps.json')
    .then(res => res.json())
    .then(data => {
      allApps = data;
      renderCards();
    })
    .catch(err => console.error('apps load error', err));

  // カード描画
  function renderCards() {
    const grid = document.getElementById('app-card-grid');
    grid.innerHTML = '';

    const filtered = allApps.filter(app => {
      const okSubject = activeSubject ? app.subject === activeSubject : true;
      const okType    = activeType    ? app.type === activeType       : true;
      return okSubject && okType;
    });

    filtered.forEach(app => {
      const card = document.createElement('div');
      card.className = "flex flex-col bg-white dark:bg-gray-800 rounded-xl shadow-sm hover:shadow-lg transition-shadow duration-300";

      card.innerHTML = `
        <div class="p-6">
          <div class="flex items-center gap-4 mb-4">
            <div class="w-16 h-16 bg-center bg-no-repeat aspect-square bg-cover rounded-lg"
                 style="background-image: url('${app.iconImage}');"></div>
            <h3 class="text-gray-900 dark:text-white text-lg font-bold flex-1">${app.title}</h3>
          </div>
          <p class="text-gray-600 dark:text-gray-400 text-sm mb-4 leading-relaxed">${app.description}</p>
          <div class="flex gap-2 flex-wrap">
            <span class="inline-block bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-1 rounded-full">${app.subject}</span>
            <span class="inline-block bg-green-100 text-green-800 text-xs font-semibold px-2.5 py-1 rounded-full">${app.type}</span>
          </div>
        </div>
        <div class="mt-auto p-4 bg-gray-50 dark:bg-gray-800/50 flex gap-3">
          <a href="${app.launchUrl}" target="_blank" rel="noopener noreferrer"
            class="flex-1 flex items-center justify-center rounded-lg h-10 px-4 bg-primary text-white text-sm font-bold hover:bg-primary/90 transition-colors">起動</a>
          <a href="${app.detailUrl}"
            class="flex-1 flex items-center justify-center rounded-lg h-10 px-4 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm font-bold hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">詳細</a>
        </div>
      `;

      grid.appendChild(card);
    });
  }

  // フィルター関連
  function toggleFilter(e) {
    const btn = e.currentTarget;
    const subject = btn.getAttribute('data-subject');
    const type = btn.getAttribute('data-type');

    if (subject !== null) {
      activeSubject = (activeSubject === subject) ? null : subject;
    }
    if (type !== null) {
      activeType = (activeType === type) ? null : type;
    }

    renderCards();
    highlightFilters();
  }

  function highlightFilters() {
    const activeClass = "flex h-9 items-center justify-center rounded-full bg-primary/20 px-4 text-primary text-sm font-medium transition-colors";
    const inactiveClass = "flex h-9 items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 px-4 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm font-medium transition-colors";

    document.querySelectorAll('[data-subject]').forEach(btn => {
      const val = btn.getAttribute('data-subject');
      btn.className = (activeSubject === val) ? activeClass : inactiveClass;
    });

    document.querySelectorAll('[data-type]').forEach(btn => {
      const val = btn.getAttribute('data-type');
      btn.className = (activeType === val) ? activeClass : inactiveClass;
    });
  }

  window.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('[data-subject], [data-type]').forEach(btn => {
      btn.addEventListener('click', toggleFilter);
    });
    highlightFilters();
  });
</script>

</body>
</html>
